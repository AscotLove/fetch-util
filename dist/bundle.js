!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";var u=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var e=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e};function a(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var t=new(function(){function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};u(this,s);var t=e.type,n=void 0===t?"local":t,i=e.time,r=void 0===i?5e3:i,o=e.cacheSize,a=void 0===o?2.5:o;this.type=n,this.time=r,this.cacheSize=1024*a*1024,this.usage=0,this.storageType={local:"localStorage",session:"sessionStorage",cookie:"cookie",indexDb:"indexDb",normal:"normal"},this.initEstimate()}return e(s,[{key:"getCacheSize",value:function(){var e=window[this.storageType[this.type]];if(""===e)return!1;var t=0;for(var n in e)e.hasOwnProperty(n)&&(t+=this.getSize(e.getItem(n)));return t}},{key:"getCacheSort",value:function(){var e=window[this.storageType[this.type]];if(""===e)return!1;var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({key:n,value:e.getItem(n)});return t.sort(function(e,t){return JSON.parse(e.value).time-JSON.parse(t.value).time})}},{key:"judgeMemory",value:function(e){if(this.getSize(e)+this.usage>this.cacheSize){var t,n=a(this.getCacheSort());try{for(n.s();!(t=n.n()).done;){var i=t.value,r=i.key,o=i.value;if(this.getSize(o)+this.usage<this.cacheSize)break;this.usage=this.usage-this.getSize(o),this.baseRemoveItem(r)[this.type].apply(this)}}catch(e){n.e(e)}finally{n.f()}}else this.usage=this.getSize(e)+this.usage}},{key:"getSize",value:function(e,t){var n,i,r,o=0;if("utf-16"===(t=t?t.toLowerCase():"")||"utf16"===t)for(i=0,r=e.length;i<r;i++)o+=(n=e.charCodeAt(i))<=65535?2:4;else for(i=0,r=e.length;i<r;i++)o+=(n=e.charCodeAt(i))<=127?1:n<=2047?2:n<=65535?3:4;return o}},{key:"initEstimate",value:function(){var t=this;navigator&&navigator.storage?navigator.storage.estimate().then(function(e){t.usage=e.usage,t.quota=e.quota,console.log(t.usage,t.quota)}):this.usage=this.getCacheSize(this.type),console.log("usage",this.usage)}},{key:"baseSetItem",value:function(e,t){return{local:function(){window[this.storageType[this.type]].setItem(e,t)},session:function(){window[this.storageType[this.type]].setItem(e,t)},cookie:function(){},indexDb:function(){},normal:function(){window.baseStorage?window.baseStorage[e]=t:window.baseStorage={}}}}},{key:"baseRemoveItem",value:function(e){return{local:function(){window[this.storageType[this.type]].removeItem(e)},session:function(){window[this.storageType[this.type]].removeItem(e)},cookie:function(){},indexDb:function(){},normal:function(){delete window.baseStorage[e]}}}},{key:"setItem",value:function(e,t){try{if(!t)return;var n=JSON.stringify({value:t,time:(new Date).getTime()});this.judgeMemory(n),this.baseSetItem(e,n)[this.type].apply(this)}catch(e){console.log(e)}}},{key:"getItem",value:function(e){try{var t=JSON.parse(window[this.storageType[this.type]].getItem(e)),n=t.time,i=t.value;return(new Date).getTime()>n+this.time?(this.baseRemoveItem(e)[this.type].apply(this),null):i}catch(e){return null}}}]),s}())({cacheSize:15e-5,time:1e10});console.log(t),t.setItem("test5","tes敖德萨所大tes敖德萨所大所t4所t4")});
