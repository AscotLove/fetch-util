!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";var j=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var t=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e};var e=function(r,n,e,t,o){var i={};return Object.keys(t).forEach(function(e){i[e]=t[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=e.slice().reverse().reduce(function(e,t){return t(r,n,e)||e},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(r,n,i),i=null),i};var o=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n};var r=function(e){if(Array.isArray(e))return o(e)};var i=function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)};var a=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}};var c=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")};var u=function(e){return r(e)||i(e)||a(e)||c()};var s=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e};function l(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r}function S(e,t){A.apply(e,C(t)?t:[t])}function P(e,t,r,n,o,i,a,c,u,s,l,f,p){var y,d=e;if("function"==typeof a?d=a(t,d):d instanceof Date?d=s(d):"comma"===r&&C(d)&&(d=D.maybeMap(d,function(e){return e instanceof Date?s(e):e}).join(",")),null===d){if(n)return i&&!f?i(t,z.encoder,p,"key"):t;d=""}if("string"==typeof(y=d)||"number"==typeof y||"boolean"==typeof y||"symbol"===k(y)||"bigint"==typeof y||D.isBuffer(d))return i?[l(f?t:i(t,z.encoder,p,"key"))+"="+l(i(d,z.encoder,p,"value"))]:[l(t)+"="+l(String(d))];var h,g,v=[];if(void 0===d)return v;g=C(a)?a:(h=Object.keys(d),c?h.sort(c):h);for(var m=0;m<g.length;++m){var b,O=g[m],w=d[O];o&&null===w||(b=C(d)?"function"==typeof r?r(t,O):t:t+(u?"."+O:"["+O+"]"),S(v,P(w,b,r,n,o,i,a,c,u,s,l,f,p)))}return v}var f,p,y,d,k=(function(t){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(e){return typeof e}:t.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.exports=r}(f={exports:{}}),f.exports),h=Object.prototype.hasOwnProperty,g=Array.isArray,v=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),D={arrayToObject:l,assign:function(e,r){return Object.keys(r).reduce(function(e,t){return e[t]=r[t],e},e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var o=t[n],i=o.obj[o.prop],a=Object.keys(i),c=0;c<a.length;++c){var u=a[c],s=i[u];"object"===k(s)&&null!==s&&-1===r.indexOf(s)&&(t.push({obj:i,prop:u}),r.push(s))}return function(e){for(;1<e.length;){var t=e.pop(),r=t.obj[t.prop];if(g(r)){for(var n=[],o=0;o<r.length;++o)void 0!==r[o]&&n.push(r[o]);t.obj[t.prop]=n}}}(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r){if(0===e.length)return e;var n=e;if("symbol"===k(e)?n=Symbol.prototype.toString.call(e):"string"!=typeof e&&(n=String(e)),"iso-8859-1"===r)return escape(n).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var o="",i=0;i<n.length;++i){var a=n.charCodeAt(i);45===a||46===a||95===a||126===a||48<=a&&a<=57||65<=a&&a<=90||97<=a&&a<=122?o+=n.charAt(i):a<128?o+=v[a]:a<2048?o+=v[192|a>>6]+v[128|63&a]:a<55296||57344<=a?o+=v[224|a>>12]+v[128|a>>6&63]+v[128|63&a]:(i+=1,a=65536+((1023&a)<<10|1023&n.charCodeAt(i)),o+=v[240|a>>18]+v[128|a>>12&63]+v[128|a>>6&63]+v[128|63&a])}return o},isBuffer:function(e){return!(!e||"object"!==k(e))&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(g(e)){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)},merge:function n(o,i,a){if(!i)return o;if("object"!==k(i)){if(g(o))o.push(i);else{if(!o||"object"!==k(o))return[o,i];(a&&(a.plainObjects||a.allowPrototypes)||!h.call(Object.prototype,i))&&(o[i]=!0)}return o}if(!o||"object"!==k(o))return[o].concat(i);var e=o;return g(o)&&!g(i)&&(e=l(o,a)),g(o)&&g(i)?(i.forEach(function(e,t){var r;h.call(o,t)?(r=o[t])&&"object"===k(r)&&e&&"object"===k(e)?o[t]=n(r,e,a):o.push(e):o[t]=e}),o):Object.keys(i).reduce(function(e,t){var r=i[t];return h.call(e,t)?e[t]=n(e[t],r,a):e[t]=r,e},e)}},m=String.prototype.replace,b=/%20/g,O={RFC1738:"RFC1738",RFC3986:"RFC3986"},w=D.assign({default:O.RFC3986,formatters:{RFC1738:function(e){return m.call(e,b,"+")},RFC3986:function(e){return String(e)}}},O),T=Object.prototype.hasOwnProperty,E={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},C=Array.isArray,A=Array.prototype.push,N=Date.prototype.toISOString,x=w.default,z={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:D.encode,encodeValuesOnly:!1,format:x,formatter:w.formatters[x],indices:!1,serializeDate:function(e){return N.call(e)},skipNulls:!1,strictNullHandling:!1},F=(Object.prototype.hasOwnProperty,Array.isArray,function(e,t){var r=e,n=function(e){if(!e)return z;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||z.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=w.default;if(void 0!==e.format){if(!T.call(w.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=w.formatters[r],o=z.filter;return"function"!=typeof e.filter&&!C(e.filter)||(o=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:z.addQueryPrefix,allowDots:void 0===e.allowDots?z.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:z.charsetSentinel,delimiter:void 0===e.delimiter?z.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:z.encode,encoder:"function"==typeof e.encoder?e.encoder:z.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:z.encodeValuesOnly,filter:o,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:z.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:z.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:z.strictNullHandling}}(t);"function"==typeof n.filter?r=(0,n.filter)("",r):C(n.filter)&&(c=n.filter);var o,i=[];if("object"!==k(r)||null===r)return"";o=t&&t.arrayFormat in E?t.arrayFormat:!(t&&"indices"in t)||t.indices?"indices":"repeat";var a=E[o],c=c||Object.keys(r);n.sort&&c.sort(n.sort);for(var u=0;u<c.length;++u){var s=c[u];n.skipNulls&&null===r[s]||S(i,P(r[s],s,a,n.strictNullHandling,n.skipNulls,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.formatter,n.encodeValuesOnly,n.charset))}var l=i.join(n.delimiter),f=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),0<l.length?f+l:""}),I=function(){function a(e){j(this,a);var t=e.type,r=e.time,n=void 0===r?5e3:r,o=e.cacheSize,i=void 0===o?2.5:o;this.type=t,this.time=n,this.cacheSize=1024*i*1024,console.log(this.cacheSize),this.storageType={local:"localStorage",session:"sessionStorage",cookie:"cookie",indexDb:"indexDb",nomal:"nomal"},this.initEstimate(),console.log(this.getCacheSize(t))}return t(a,[{key:"getCacheSize",value:function(e){var t="";if("local"===(0<arguments.length&&void 0!==e?e:"local")?window.localStorage?t=window.localStorage:console.log("浏览器不支持localStorage"):window.sessionStorage?t=window.sessionStorage:console.log("浏览器不支持sessionStorage"),""!==t){var r=0;for(var n in t)t.hasOwnProperty(n)&&(r+=t.getItem(n).length);return r}}},{key:"initEstimate",value:function(){var t=this;navigator&&navigator.storage&&navigator.storage.estimate().then(function(e){t.usage=e.usage,t.quota=e.quota,console.log(t.usage,t.quota)})}},{key:"setItem",value:function(e,t){window[this.storageType[this.type]].setItem(e,JSON.stringify({value:t,time:(new Date).getTime()}))}},{key:"getItem",value:function(e){try{var t=JSON.parse(window[this.storageType[this.type]].getItem(e)),r=t.time,n=t.value;return(new Date).getTime()>r+this.time?(window[this.storageType[this.type]].removeItem(e),null):n}catch(e){return null}}}]),a}();function R(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function q(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?R(Object(r),!0).forEach(function(e){s(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function B(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function U(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?B(Object(r),!0).forEach(function(e){s(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var H=new(function(){function w(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};j(this,w);var t=e.cache,r=void 0===t?"no-cache":t,n=e.credentials,o=void 0===n?"same-origin":n,i=e.headers,a=void 0===i?{}:i,c=e.mode,u=void 0===c?"cors":c,s=e.redirect,l=void 0===s?"follow":s,f=e.referrer,p=void 0===f?"no-referrer":f,y=e.timeOut,d=void 0===y?3e3:y,h=e.BASE_URL,g=void 0===h?"":h,v=e.requestType,m=void 0===v?"JSON":v,b=e.cacheType,O=void 0===b?"":b;this.FetchConfig={cache:r,credentials:o,headers:a,mode:u,redirect:l,referrer:p},this.config={timeOut:d,BASE_URL:g,requestType:m},this.cacheStorage=O?new I({type:O}):"",this.dataOperation={JSON:{headers:{"Content-Type":"application/json"},formatting:function(e){return JSON.stringify(e)}},FormData:{headers:{"Content-Type":"application/x-www-form-urlencoded"},formatting:function(t){var r=new FormData;return Object.keys(t).forEach(function(e){r.append(e,t[e])}),r}}}}return t(w,[{key:"send",value:function(e){var n=e.url,o=e.FetchConfig,t=this.config,i=t.BASE_URL,r=t.timeOut,a=new Promise(function(t,r){fetch(i?"".concat(i,"/").concat(n):n,o).then(function(e){return e.ok?e.json():void r({status:e.status,msg:e.statusText})}).then(function(e){t(e)})}),c=new Promise(function(e,t){setTimeout(function(){t("time out")},r)});return Promise.race([a,c])}},{key:"preSend",value:function(e){var t=e.url,r=e.params,n=e.headers,o=e.method,i=this.config.requestType,a=q(q({},this.FetchConfig),{},{method:o,headers:q(q({},this.dataOperation[i].headers),n)});return r&&(a.body=this.dataOperation[i].formatting(r)),this.send({url:t,FetchConfig:a})}},{key:"get",value:function(e){var t=this,r=e.url,n=e.query,o=e.headers,i=n?"".concat(r,"?").concat(F(n)):r;return this.cacheStorage?this.cacheStorage.getItem(i)?Promise.resolve(this.cacheStorage.getItem(i)):this.preSend({url:i,headers:o,method:"GET"}).then(function(e){return t.cacheStorage.setItem(i,e),e}):this.preSend({url:i,headers:o,method:"GET"})}},{key:"post",value:function(e){var t=e.url,r=e.query,n=e.params,o=void 0===n?{}:n,i=e.headers;return this.preSend({url:r?"".concat(t,"?").concat(F(r)):t,params:o,headers:i,method:"POST"})}}]),w}())({requestType:"JSON",cacheType:"local"});var J,Q,V=new(J=3e3,p=function(e,t,n){return U(U({},n),{},{value:function(e){var t=arguments,r=this;Q=Q||setTimeout(function(){Q=null,n.value.apply(r,u(t))},J)}})},y=function(e,n){switch(e){case"GET":return function(e,t,r){return U(U({},r),{},{value:function(e){var t=arguments;H.get({url:n,query:e}).then(function(e){r.value.apply({result:e},u(t))}).catch(function(e){console.log("err====>",e)})}})};default:return function(e,t,r){}}}("GET","https://api.github.com/users/octocat"),e((d=function(){function e(){j(this,e)}return t(e,[{key:"getOct",value:function(e){console.log(e),console.log("result==>",this.result)}}]),e}()).prototype,"getOct",[p,function(e,t,r){return U(U({},r),{},{value:function(e){try{console.time("consuming"),console.log("发送埋点",e),r.value.apply(this,Array.prototype.slice.call(arguments))}finally{console.timeEnd("consuming")}}})},y],Object.getOwnPropertyDescriptor(d.prototype,"getOct"),d.prototype),d);V.getOct({test:1}),V.getOct({test:1}),V.getOct({test:1}),V.getOct({test:1}),V.getOct({test:1}),V.getOct({test:1})});
