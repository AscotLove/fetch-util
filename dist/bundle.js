!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";var o=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e};var w=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function n(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var e=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e};function t(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},o=0;o<e.length;++o)void 0!==e[o]&&(r[o]=e[o]);return r}function j(e,t){f.apply(e,T(t)?t:[t])}function k(e,t,r,o,n,i,a,c,s,u,l,f,p){var d,h=e;if("function"==typeof a?h=a(t,h):h instanceof Date?h=u(h):"comma"===r&&T(h)&&(h=D.maybeMap(h,function(e){return e instanceof Date?u(e):e}).join(",")),null===h){if(o)return i&&!f?i(t,E.encoder,p,"key"):t;h=""}if("string"==typeof(d=h)||"number"==typeof d||"boolean"==typeof d||"symbol"===P(d)||"bigint"==typeof d||D.isBuffer(h))return i?[l(f?t:i(t,E.encoder,p,"key"))+"="+l(i(h,E.encoder,p,"value"))]:[l(t)+"="+l(String(h))];var y,g,m=[];if(void 0===h)return m;g=T(a)?a:(y=Object.keys(h),c?y.sort(c):y);for(var v=0;v<g.length;++v){var b,O=g[v],S=h[O];n&&null===S||(b=T(h)?"function"==typeof r?r(t,O):t:t+(s?"."+O:"["+O+"]"),j(m,k(S,b,r,o,n,i,a,c,s,u,l,f,p)))}return m}var r,P=(function(t){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(e){return typeof e}:t.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.exports=r}(r={exports:{}}),r.exports),c=Object.prototype.hasOwnProperty,l=Array.isArray,s=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),D={arrayToObject:t,assign:function(e,r){return Object.keys(r).reduce(function(e,t){return e[t]=r[t],e},e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],o=0;o<t.length;++o)for(var n=t[o],i=n.obj[n.prop],a=Object.keys(i),c=0;c<a.length;++c){var s=a[c],u=i[s];"object"===P(u)&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:i,prop:s}),r.push(u))}return function(e){for(;1<e.length;){var t=e.pop(),r=t.obj[t.prop];if(l(r)){for(var o=[],n=0;n<r.length;++n)void 0!==r[n]&&o.push(r[n]);t.obj[t.prop]=o}}}(t),e},decode:function(e,t,r){var o=e.replace(/\+/g," ");if("iso-8859-1"===r)return o.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(o)}catch(e){return o}},encode:function(e,t,r){if(0===e.length)return e;var o=e;if("symbol"===P(e)?o=Symbol.prototype.toString.call(e):"string"!=typeof e&&(o=String(e)),"iso-8859-1"===r)return escape(o).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var n="",i=0;i<o.length;++i){var a=o.charCodeAt(i);45===a||46===a||95===a||126===a||48<=a&&a<=57||65<=a&&a<=90||97<=a&&a<=122?n+=o.charAt(i):a<128?n+=s[a]:a<2048?n+=s[192|a>>6]+s[128|63&a]:a<55296||57344<=a?n+=s[224|a>>12]+s[128|a>>6&63]+s[128|63&a]:(i+=1,a=65536+((1023&a)<<10|1023&o.charCodeAt(i)),n+=s[240|a>>18]+s[128|a>>12&63]+s[128|a>>6&63]+s[128|63&a])}return n},isBuffer:function(e){return!(!e||"object"!==P(e))&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(l(e)){for(var r=[],o=0;o<e.length;o+=1)r.push(t(e[o]));return r}return t(e)},merge:function o(n,i,a){if(!i)return n;if("object"!==P(i)){if(l(n))n.push(i);else{if(!n||"object"!==P(n))return[n,i];(a&&(a.plainObjects||a.allowPrototypes)||!c.call(Object.prototype,i))&&(n[i]=!0)}return n}if(!n||"object"!==P(n))return[n].concat(i);var e=n;return l(n)&&!l(i)&&(e=t(n,a)),l(n)&&l(i)?(i.forEach(function(e,t){var r;c.call(n,t)?(r=n[t])&&"object"===P(r)&&e&&"object"===P(e)?n[t]=o(r,e,a):n.push(e):n[t]=e}),n):Object.keys(i).reduce(function(e,t){var r=i[t];return c.call(e,t)?e[t]=o(e[t],r,a):e[t]=r,e},e)}},i=String.prototype.replace,a=/%20/g,u={RFC1738:"RFC1738",RFC3986:"RFC3986"},p=D.assign({default:u.RFC3986,formatters:{RFC1738:function(e){return i.call(e,a,"+")},RFC3986:function(e){return String(e)}}},u),d=Object.prototype.hasOwnProperty,h={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},T=Array.isArray,f=Array.prototype.push,y=Date.prototype.toISOString,g=p.default,E={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:D.encode,encodeValuesOnly:!1,format:g,formatter:p.formatters[g],indices:!1,serializeDate:function(e){return y.call(e)},skipNulls:!1,strictNullHandling:!1},m=(Object.prototype.hasOwnProperty,Array.isArray,function(e,t){var r=e,o=function(e){if(!e)return E;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||E.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=p.default;if(void 0!==e.format){if(!d.call(p.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var o=p.formatters[r],n=E.filter;return"function"!=typeof e.filter&&!T(e.filter)||(n=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:E.addQueryPrefix,allowDots:void 0===e.allowDots?E.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:E.charsetSentinel,delimiter:void 0===e.delimiter?E.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:E.encode,encoder:"function"==typeof e.encoder?e.encoder:E.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:E.encodeValuesOnly,filter:n,formatter:o,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:E.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:E.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:E.strictNullHandling}}(t);"function"==typeof o.filter?r=(0,o.filter)("",r):T(o.filter)&&(c=o.filter);var n,i=[];if("object"!==P(r)||null===r)return"";n=t&&t.arrayFormat in h?t.arrayFormat:!(t&&"indices"in t)||t.indices?"indices":"repeat";var a=h[n],c=c||Object.keys(r);o.sort&&c.sort(o.sort);for(var s=0;s<c.length;++s){var u=c[s];o.skipNulls&&null===r[u]||j(i,k(r[u],u,a,o.strictNullHandling,o.skipNulls,o.encode?o.encoder:null,o.filter,o.sort,o.allowDots,o.serializeDate,o.formatter,o.encodeValuesOnly,o.charset))}var l=i.join(o.delimiter),f=!0===o.addQueryPrefix?"?":"";return o.charsetSentinel&&("iso-8859-1"===o.charset?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),0<l.length?f+l:""}),C=function(){function a(e){w(this,a);var t=e.type,r=e.time,o=void 0===r?5e3:r,n=e.cacheSize,i=void 0===n?2.5:n;this.type=t,this.time=o,this.cacheSize=1024*i*1024,console.log(this.cacheSize),this.storageType={local:"localStorage",session:"sessionStorage",cookie:"cookie",indexDb:"indexDb",nomal:"nomal"},this.initEstimate(),console.log(this.getCacheSize(t))}return e(a,[{key:"getCacheSize",value:function(e){var t="";if("local"===(0<arguments.length&&void 0!==e?e:"local")?window.localStorage?t=window.localStorage:console.log("浏览器不支持localStorage"):window.sessionStorage?t=window.sessionStorage:console.log("浏览器不支持sessionStorage"),""!==t){var r=0;for(var o in t)t.hasOwnProperty(o)&&(r+=t.getItem(o).length);return r}}},{key:"initEstimate",value:function(){var t=this;navigator&&navigator.storage&&navigator.storage.estimate().then(function(e){t.usage=e.usage,t.quota=e.quota,console.log(t.usage,t.quota)})}},{key:"setItem",value:function(e,t){window[this.storageType[this.type]].setItem(e,JSON.stringify({value:t,time:(new Date).getTime()}))}},{key:"getItem",value:function(e){try{var t=JSON.parse(window[this.storageType[this.type]].getItem(e)),r=t.time,o=t.value;return(new Date).getTime()>r+this.time?(window[this.storageType[this.type]].removeItem(e),null):o}catch(e){return null}}}]),a}();function v(t,e){var r,o=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,r)),o}function b(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?v(Object(r),!0).forEach(function(e){o(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var O=new(function(){function S(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};w(this,S);var t=e.cache,r=void 0===t?"no-cache":t,o=e.credentials,n=void 0===o?"same-origin":o,i=e.headers,a=void 0===i?{}:i,c=e.mode,s=void 0===c?"cors":c,u=e.redirect,l=void 0===u?"follow":u,f=e.referrer,p=void 0===f?"no-referrer":f,d=e.timeOut,h=void 0===d?3e3:d,y=e.BASE_URL,g=void 0===y?"":y,m=e.requestType,v=void 0===m?"JSON":m,b=e.cacheType,O=void 0===b?"":b;this.FetchConfig={cache:r,credentials:n,headers:a,mode:s,redirect:l,referrer:p},this.config={timeOut:h,BASE_URL:g,requestType:v},this.cacheStorage=O?new C({type:O}):"",this.dataOperation={JSON:{headers:{"Content-Type":"application/json"},formatting:function(e){return JSON.stringify(e)}},FormData:{headers:{"Content-Type":"application/x-www-form-urlencoded"},formatting:function(t){var r=new FormData;return Object.keys(t).forEach(function(e){r.append(e,t[e])}),r}}}}return e(S,[{key:"send",value:function(e){var o=e.url,n=e.FetchConfig,t=this.config,i=t.BASE_URL,r=t.timeOut,a=new Promise(function(t,r){fetch(i?"".concat(i,"/").concat(o):o,n).then(function(e){return e.ok?e.json():void r({status:e.status,msg:e.statusText})}).then(function(e){t(e)})}),c=new Promise(function(e,t){setTimeout(function(){t("time out")},r)});return Promise.race([a,c])}},{key:"preSend",value:function(e){var t=e.url,r=e.params,o=e.headers,n=e.method,i=this.config.requestType,a=b(b({},this.FetchConfig),{},{method:n,headers:b(b({},this.dataOperation[i].headers),o)});return r&&(a.body=this.dataOperation[i].formatting(r)),this.send({url:t,FetchConfig:a})}},{key:"get",value:function(e){var t=this,r=e.url,o=e.query,n=e.headers,i=o?"".concat(r,"?").concat(m(o)):r;return this.cacheStorage?this.cacheStorage.getItem(i)?Promise.resolve(this.cacheStorage.getItem(i)):this.preSend({url:i,headers:n,method:"GET"}).then(function(e){return t.cacheStorage.setItem(i,e),e}):this.preSend({url:i,headers:n,method:"GET"})}},{key:"post",value:function(e){var t=e.url,r=e.query,o=e.params,n=void 0===o?{}:o,i=e.headers;return this.preSend({url:r?"".concat(t,"?").concat(m(r)):t,params:n,headers:i,method:"POST"})}}]),S}())({requestType:"JSON",cacheType:"local",BASE_URL:"https://api.github.com"}),S={get:function(e,t){return new Promise(function(n,i){O.get({url:e,query:t}).then(function(e){var t=e.data,r=e.code,o=e.errMessage;r?n(t):i(o)})})},post:function(e,t){return new Promise(function(n,i){O.post({url:e,params:t}).then(function(e){var t=e.data,r=e.code,o=e.errMessage;r?n(t):i(o)})})}},N=["get","post","put","delete"],x={users:"octocats",user:"octocat"},F={};Object.keys(x).forEach(function(r){F[r]={},N.forEach(function(t){F[r][t]=function(e){return S[t]("".concat("users","/").concat(x[r]),e)}})});var A={user:F};console.log(A.user),A.user.user.post({test:1})});
